on:
  push:
    branches:
    - main
    - release/*
  workflow_dispatch:

jobs:
  helm_package:
    name: Package Helm Chart
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
        name: Checkout

      - run: |
          curl https://baltocdn.com/helm/signing.asc | gpg --dearmor | sudo tee /usr/share/keyrings/helm.gpg > /dev/null
          sudo apt-get install apt-transport-https --yes
          echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list
          sudo apt-get update
          sudo apt-get install helm -v 3.12.3 --yes

          helm version

          echo "${{ secrets.DOCKER_HUB_PASSWORD }}" | helm registry login registry-1.docker.io -u ${{ vars.DOCKER_HUB_USERNAME }} --password-stdin  
          helm package govna/
          helm push govna-0.1.0.tgz oci://registry-1.docker.io/${{ vars.DOCKER_HUB_USERNAME }}/govna
        name: Package and Push Helm Chart